var PointAndClick=pc.createScript("pointAndClick");PointAndClick.attributes.add("cameraEntity",{type:"entity",title:"Camera Entity"}),PointAndClick.attributes.add("playerEntity",{type:"entity",title:"Player Entity"}),PointAndClick.attributes.add("playerSpeed",{type:"number",default:0,title:"Player Speed"}),PointAndClick.prototype.initialize=function(){this.groundShape=new pc.BoundingBox(new pc.Vec3(0,0,0),new pc.Vec3(4,.001,4)),this.direction=new pc.Vec3,this.distanceToTravel=0,this.targetPosition=new pc.Vec3,this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.touch&&this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this)},PointAndClick.newPosition=new pc.Vec3,PointAndClick.prototype.update=function(t){if(this.direction.lengthSq()>0){var i=this.playerSpeed*t,n=PointAndClick.newPosition;n.copy(this.direction).scale(i),n.add(this.playerEntity.getPosition()),this.playerEntity.setPosition(n),this.distanceToTravel-=i,this.distanceToTravel<=0&&(this.playerEntity.setPosition(this.targetPosition),this.direction.set(0,0,0))}},PointAndClick.prototype.movePlayerTo=function(t){this.targetPosition.copy(t),this.targetPosition.y=this.playerEntity.getPosition().y,this.distanceTravelled=0,this.direction.sub2(this.targetPosition,this.playerEntity.getPosition()),this.distanceToTravel=this.direction.length(),this.distanceToTravel>0?(this.direction.normalize(),this.playerEntity.lookAt(this.targetPosition)):this.direction.set(0,0,0)},PointAndClick.prototype.onMouseDown=function(t){t.button==pc.MOUSEBUTTON_LEFT&&this.doRayCast(t)},PointAndClick.prototype.onTouchStart=function(t){1==t.touches.length&&(this.doRayCast(t.touches[0]),t.event.preventDefault())},PointAndClick.ray=new pc.Ray,PointAndClick.hitPosition=new pc.Vec3,PointAndClick.prototype.doRayCast=function(t){var i=PointAndClick.ray,n=PointAndClick.hitPosition;this.cameraEntity.camera.screenToWorld(t.x,t.y,this.cameraEntity.camera.farClip,i.direction),i.origin.copy(this.cameraEntity.getPosition()),i.direction.sub(i.origin).normalize(),this.groundShape.intersectsRay(i,n)&&this.movePlayerTo(n)};